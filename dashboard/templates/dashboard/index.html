{% extends "global/base.html" %} {% load static %} {% block content %}

<nav class="w-full border-b bg-white">
  <div class="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <img src="{% static 'images/logo.svg' %}" alt="Logo" class="w-8 h-8" />
      <span class="font-semibold text-lg">AniverLembre</span>
    </div>
    <div class="flex items-center gap-2">
      <button
        id="openCreateDialog"
        class="px-3 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700"
      >
        Novo Contato + Lembrete
      </button>
    </div>
  </div>
</nav>

<main class="max-w-5xl mx-auto px-4 py-6">
  <h1 class="text-2xl font-bold mb-4">Seus Lembretes</h1>
  {% if reminders %}
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
    {% for r in reminders %}
    <div class="rounded border shadow-sm p-4 bg-white">
      <div class="flex justify-between items-start">
        <div>
          <h3 class="font-semibold">{{ r.contact.name }}</h3>
          <p class="text-gray-600 text-sm">
            Aniversário: {{ r.contact.birthday }}
          </p>
        </div>
        <span
          class="text-xs px-2 py-1 rounded {{ r.active|yesno:'bg-green-100 text-green-700,bg-gray-100 text-gray-700' }}"
          >{{ r.active|yesno:'Ativo,Inativo' }}</span
        >
      </div>
      <div class="mt-3 text-sm text-gray-700">
        <p>Notificar às {{ r.notifiy_at }} ({{ r.days_before }} dias antes)</p>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p class="text-gray-600">Você ainda não tem lembretes. Crie o primeiro!</p>
  {% endif %}

  <h2 class="text-xl font-bold mt-8 mb-3">Contatos</h2>
  {% if contacts %}
  <ul class="grid grid-cols-1 sm:grid-cols-2 gap-2">
    {% for contact in contacts %}
    <li class="rounded border p-3 bg-white">
      <div class="font-medium">{{ contact.name }}</div>
      <div class="text-gray-600 text-sm">
        Aniversário: {{ contact.birthday }}
      </div>
      {% if contact.relationship %}
      <div class="text-gray-600 text-sm">
        Relação: {{ contact.relationship }}
      </div>
      {% endif %}
    </li>
    {% endfor %}
  </ul>
  {% else %}
  <p class="text-gray-600">Nenhum contato cadastrado.</p>
  {% endif %}
</main>

<!-- Dialog: Create Contact + Reminder -->
<dialog id="createDialog" class="rounded max-w-lg w-full p-0">
  <form method="dialog">
    <div class="flex justify-between items-center px-4 py-3 border-b">
      <h3 class="text-lg font-semibold">Novo Contato + Lembrete</h3>
      <button id="closeCreateDialog" class="text-gray-500 hover:text-gray-700">
        ✕
      </button>
    </div>
  </form>
  <form
    method="post"
    action="{% url 'dashboard:create_reminder' %}"
    class="px-4 py-4 grid grid-cols-1 gap-3"
  >
    {% csrf_token %}
    <fieldset class="border rounded p-3">
      <legend class="text-sm font-semibold px-1">Contato</legend>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
        <div>
          <label class="block text-sm mb-1">Nome</label>
          {{ contact_form.name }}
        </div>
        <div>
          <label class="block text-sm mb-1">Aniversário</label>
          {{ contact_form.birthday }}
        </div>
        <div>
          <label class="block text-sm mb-1">Relação</label>
          {{ contact_form.relationship }}
        </div>
        <div class="sm:col-span-2">
          <label class="block text-sm mb-1">Notas</label>
          {{ contact_form.notes }}
        </div>
      </div>
    </fieldset>

    <fieldset class="border rounded p-3">
      <legend class="text-sm font-semibold px-1">Lembrete</legend>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
        <div>
          <label class="block text-sm mb-1">Dias antes</label>
          {{ reminder_form.days_before }}
        </div>
        <div>
          <label class="block text-sm mb-1">Horário de notificação</label>
          {{ reminder_form.notifiy_at }}
        </div>
        <div class="flex items-center gap-2">
          {{ reminder_form.active }}
          <label class="text-sm">Ativo</label>
        </div>
      </div>
    </fieldset>

    <div class="flex justify-end gap-2 mt-2">
      <button type="button" id="cancelCreate" class="px-3 py-2 rounded border">
        Cancelar
      </button>
      <button type="submit" class="px-3 py-2 rounded bg-indigo-600 text-white">
        Salvar
      </button>
    </div>
  </form>
</dialog>

<script>
  const createDialog = document.getElementById("createDialog");
  const openCreateBtn = document.getElementById("openCreateDialog");
  const closeCreateBtn = document.getElementById("closeCreateDialog");
  const cancelCreateBtn = document.getElementById("cancelCreate");

  function openCreate() {
    if (createDialog) createDialog.showModal();
  }
  function closeCreate() {
    if (createDialog) createDialog.close();
  }

  if (openCreateBtn) openCreateBtn.addEventListener("click", openCreate);
  if (closeCreateBtn)
    closeCreateBtn.addEventListener("click", (e) => {
      e.preventDefault();
      closeCreate();
    });
  if (cancelCreateBtn) cancelCreateBtn.addEventListener("click", closeCreate);
</script>

{% endblock %}
